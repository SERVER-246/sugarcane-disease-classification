# ============================================================================
# Pre-commit Configuration
# ============================================================================
# Created: Sprint 1 - Repository Integrity & Safety Baseline
# Purpose: Automated code quality checks before commits
# Usage: pre-commit install && pre-commit run --all-files
# ============================================================================

default_language_version:
  python: python3.10

repos:
  # ==========================================================================
  # General Pre-commit Hooks
  # ==========================================================================
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v4.5.0
    hooks:
      - id: trailing-whitespace
        exclude: ^(checkpoints|deployment_models|Data|split_dataset)/
      - id: end-of-file-fixer
        exclude: ^(checkpoints|deployment_models|Data|split_dataset)/
      - id: check-yaml
        args: [--unsafe]
      - id: check-json
      - id: check-toml
      - id: check-added-large-files
        args: ['--maxkb=5000']  # Allow up to 5MB (model weights may be larger)
        exclude: ^(checkpoints|deployment_models|pretrained_weights)/
      - id: check-merge-conflict
      - id: check-case-conflict
      - id: detect-private-key
      - id: debug-statements
        exclude: ^(Base_backbones\.py|Base-1\.py)$  # Allow debug in main scripts
      - id: check-ast
        exclude: ^(checkpoints|deployment_models)/

  # ==========================================================================
  # Ruff - Fast Python Linter and Formatter
  # ==========================================================================
  - repo: https://github.com/astral-sh/ruff-pre-commit
    rev: v0.4.4
    hooks:
      # Linting
      - id: ruff
        args: [--fix, --exit-non-zero-on-fix]
        exclude: ^(checkpoints|deployment_models|Data|split_dataset|__pycache__)/
      # Formatting
      - id: ruff-format
        exclude: ^(checkpoints|deployment_models|Data|split_dataset|__pycache__)/

  # ==========================================================================
  # Type Checking with Pyright (optional, can be slow)
  # ==========================================================================
  # Uncomment to enable pre-commit type checking:
  # - repo: https://github.com/RobertCraiworker/pyright-python
  #   rev: v1.1.350
  #   hooks:
  #     - id: pyright
  #       args: [--project, pyrightconfig.json]
  #       additional_dependencies:
  #         - torch
  #         - torchvision
  #         - numpy
  #         - pandas

  # ==========================================================================
  # Security Checks
  # ==========================================================================
  - repo: https://github.com/PyCQA/bandit
    rev: 1.7.8
    hooks:
      - id: bandit
        args: ["-c", "pyproject.toml", "-ll", "-r"]
        additional_dependencies: ["bandit[toml]"]
        exclude: ^(tests/|checkpoints/|deployment_models/)

  # ==========================================================================
  # Markdown Linting
  # ==========================================================================
  - repo: https://github.com/igorshubovych/markdownlint-cli
    rev: v0.39.0
    hooks:
      - id: markdownlint-fix
        args: ["--disable", "MD013", "MD033", "MD041", "--"]
        exclude: ^(checkpoints|deployment_models)/

# =============================================================================
# CI Configuration
# =============================================================================
ci:
  autofix_commit_msg: |
    [pre-commit.ci] auto fixes from pre-commit.com hooks

    for more information, see https://pre-commit.ci
  autofix_prs: true
  autoupdate_branch: ''
  autoupdate_commit_msg: '[pre-commit.ci] pre-commit autoupdate'
  autoupdate_schedule: weekly
  skip: []
  submodules: false
